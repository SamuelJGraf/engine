<form role="form" name="configure-reporting">

<script cam-script type="text/form-script">
    camForm.on('form-loaded', function() {
      camForm.variableManager.fetchVariable('ZAP_TARGET_NAME');
      camForm.variableManager.fetchVariable('ZAP_TARGET_URL');
      camForm.variableManager.fetchVariable('PROCESS_CONTEXT');

      camForm.variableManager.fetchVariable('PROCESS_SPIDER_ID');
	  camForm.variableManager.fetchVariable('ZAP_SPIDER_RUN_ID');
      camForm.variableManager.fetchVariable('ZAP_SPIDER_TARGET_URL');
      camForm.variableManager.fetchVariable('ZAP_SPIDER_INCLUDE_REGEX');
      camForm.variableManager.fetchVariable('ZAP_SPIDER_EXCLUDE_REGEX');
      camForm.variableManager.fetchVariable('ZAP_SPIDER_EXLUDE_DUPLICATES');
      camForm.variableManager.fetchVariable('ZAP_SPIDER_MAX_DEPTH');

      camForm.variableManager.fetchVariable('PROCESS_SCANNER_ID');
 	  camForm.variableManager.fetchVariable('ZAP_SCANNER_RUN_ID');
      camForm.variableManager.fetchVariable('ZAP_SCANNER_TARGET_URL');
      camForm.variableManager.fetchVariable('ZAP_SCANNER_INCLUDE_REGEX');
      camForm.variableManager.fetchVariable('ZAP_SCANNER_EXLUDE_REGEX');

      camForm.variableManager.fetchVariable('ZAP_REPORTING_CONFIGURATION_TYPE');
	  camForm.variableManager.fetchVariable('ZAP_REPORTING_TYPES');
	  camForm.variableManager.fetchVariable('ZAP_REPORTING_SERVICE_ID');
 	  camForm.variableManager.fetchVariable('ZAP_REPORTING_SERVICE_RUN_ID');
 	  camForm.variableManager.fetchVariable('ZAP_REPORTING_SERVICE_HOST');
	  camForm.variableManager.fetchVariable('ZAP_REPORTING_DASHBOARD_URL');
	  camForm.variableManager.fetchVariable('ZAP_REPORTING_DASHBOARD_BY_TIME_URL');
	  camForm.variableManager.fetchVariable('ZAP_REPORTING_FALSE_POSITIVES');
    });

    camForm.on('variables-restored', function() {
      $scope.targetName = camForm.variableManager.variableValue('ZAP_TARGET_NAME');
      $scope.targetUrl = camForm.variableManager.variableValue('ZAP_TARGET_URL');
      $scope.context = camForm.variableManager.variableValue('PROCESS_CONTEXT');

	  $scope.spiderMicroserviceId = camForm.variableManager.variableValue('PROCESS_SPIDER_ID');
	  $scope.spiderMicroserviceRunId = camForm.variableManager.variableValue('ZAP_SPIDER_RUN_ID');
	  $scope.spiderTargetUrl = camForm.variableManager.variableValue('ZAP_SPIDER_TARGET_URL');
	  $scope.spiderIncludeRegexes = camForm.variableManager.variableValue('ZAP_SPIDER_INCLUDE_REGEX');
	  $scope.spiderExcludeRegexes = camForm.variableManager.variableValue('ZAP_SPIDER_EXCLUDE_REGEX');
	  $scope.spiderExcludeDuplicates = camForm.variableManager.variableValue('ZAP_SPIDER_EXLUDE_DUPLICATES');
	  $scope.spiderMaxDepth = camForm.variableManager.variableValue('ZAP_SPIDER_MAX_DEPTH');

   	  $scope.scannerMicroserviceId = camForm.variableManager.variableValue('PROCESS_SCANNER_ID');
	  $scope.scannerMicroserviceRunId = camForm.variableManager.variableValue('ZAP_SCANNER_RUN_ID');
	  $scope.scannerTargetUrl = camForm.variableManager.variableValue('ZAP_SCANNER_TARGET_URL');
	  $scope.scannerIncludeRegexes = camForm.variableManager.variableValue('ZAP_SCANNER_INCLUDE_REGEX');
	  $scope.scannerExcludeRegexes = camForm.variableManager.variableValue('ZAP_SCANNER_EXLUDE_REGEX');

      $scope.reportingConfigurationType = camForm.variableManager.variableValue('ZAP_REPORTING_CONFIGURATION_TYPE');
	  $scope.reportingTypes = camForm.variableManager.variableValue('ZAP_REPORTING_TYPES');
 	  $scope.reportingFalsePositive = camForm.variableManager.variableValue('ZAP_REPORTING_SERVICE_ID');
	  $scope.reportingMicroserviceId = camForm.variableManager.variableValue('ZAP_REPORTING_SERVICE_RUN_ID');
	  $scope.reportingMicroserviceRunId = camForm.variableManager.variableValue('ZAP_REPORTING_SERVICE_HOST');
 	  $scope.reportingServiceHost = camForm.variableManager.variableValue('ZAP_REPORTING_DASHBOARD_URL');
	  $scope.reportingDashboardUrl = camForm.variableManager.variableValue('ZAP_REPORTING_DASHBOARD_BY_TIME_URL');
	  $scope.reportingDashboardByTimeUrl = camForm.variableManager.variableValue('ZAP_REPORTING_FALSE_POSITIVES');

      // TODO Workaround: Show dummy content if not specified (also see CAM-5292)
      if (camForm.variableManager.variable('ZAP_SPIDER_API_SPEC_FILE').type !== 'File') {
        camForm.variableManager.destroyVariable('ZAP_SPIDER_API_SPEC_FILE');
        camForm.variableManager.createVariable({name: 'ZAP_SPIDER_API_SPEC_FILE', type: 'File', valueInfo: {filename: ''}});
        $scope.spiderApiSpecFile = camForm.variableManager.variableValue('ZAP_SPIDER_API_SPEC_FILE');
      }

      console.log("setting variables to scope");
    });

 </script>
 
 	<h2>OWASP ZAP Scan Results for "{{ targetName }}"</h2>

	<div class="row">
			<div class="col-xs-12">

			<div class="">
				<div class="">
					<label>Target:</label>
					<a href="{{ targetUrl }}">{{ targetUrl }}</a>
				</div>
				<div class="">
					<label>Context:</label>
					<code>{{ context }}</code>
				</div>
			</div>
		
			<h3>Application Security Findings By Process:</h3>
			<div>
				<iframe id="showReport" ng-src="{{reportingServiceHost + reportingDashboardUrl | trustUrl }}" height="600" width="100%" style="border: 1px solid #e3e3e3;"></iframe>
			</div>
			<div class="well">Scan Process Findings By Process:
				<a href="{{reportingServiceHost + reportingDashboardUrl | trustUrl }}" target="_blank">Open Dashboard in a new Window</a>
			</div>

			<h3>Application Security Findings Overview:</h3>
			<div>
				<iframe id="showTimeReport" ng-src="{{reportingServiceHost + reportingDashboardByTimeUrl | trustUrl }}" height="600" width="100%" style="border: 1px solid #e3e3e3;"></iframe>
			</div>
			<div class="well">Security Findings By Time:
				<a href="{{reportingServiceHost + reportingDashboardByTimeUrl | trustUrl }}" target="_blank">Open Dashboard in a new Window</a>
			</div>

			<div>
				<h3>ZAP Spider Configuration</h3>
				
				<!-- Spider Type configuration -->
				<div class="form-group">
					<label for="selectSpiderTargetUrl">Spider TargetUrl</label>
					<div id="selectSpiderTargetUrl" class="controls">
						<code>{{ spiderTargetUrl }}</code>
					</div>
				</div>

				<!-- API specification file -->
				<div class="form-group">
					<label for="inputSpiderApiSpecFile">API Specification File</label>
					<div id="inputSpiderApiSpecFile" class="controls">
						<a cam-file-download="spiderApiSpecFile"></a>
					</div>
				</div>

				<!-- Spider Maximum Depth -->
				<div class="form-group">
					<label for="inputSpiderMaxDepth">Spider Maximum Depth</label>
					<div id="inputSpiderMaxDepth" class="controls">
						<code>{{ spiderMaxDepth }}</code>
					</div>
				</div>

				<!-- OWASP Spider Configuration -->
				<div class="form-group" ng-if="spiderType=='zap.spider.OwaspZapSpider'">

					<!-- spiderMicroserviceId -->
					<div class="form-group">
						<label for="selectSpiderMicroserviceId">Spider MicroserviceId</label>
						<div id="selectSpiderMicroserviceId" class="controls">
							<code>{{ spiderMicroserviceId }}</code>
						</div>
					</div>

					<!-- spiderMicroserviceRunId -->
					<div class="form-group">
						<label for="selectSpiderMicroserviceRunId">Spider MicroserviceRunId</label>
						<div id="selectSpiderMicroserviceRunId" class="controls">
							<code>{{ spiderMicroserviceRunId }}</code>
						</div>
					</div>
				
					<!-- includeRegexes -->
					<div class="form-group">
						  <label for="inputSpiderIncludeRegexes">Include sitemap pages by regular expression</label>
						  <div id="inputSpiderIncludeRegexes" class="controls">
								<code>{{ spiderIncludeRegexes }}</code>
						  </div>
					</div>

					<!-- includeRegexes -->
					<div class="form-group">
						  <label for="inputSpiderExcludeRegexes">Exclude sitemap pages by regular expression</label>
						  <div id="inputSpiderExcludeRegexes" class="controls">
								<code>{{ spiderExcludeRegexes }}</code>
						  </div>
					</div>

					<!-- includeRegexes -->
					<div class="form-group">
						  <label for="inputSpiderExcludeDuplicates">Exclude Duplicates</label>
						  <div id="inputSpiderExcludeDuplicates" class="controls">
								<code>{{ spiderExcludeDuplicates }}</code>
						  </div>
					</div>

				</div>

			</div>
			
			<div>
				<h3>ZAP Scanner Configuration</h3>
				
				<!-- Scanner Target URL -->
				<div class="form-group">
					<label for="inputScannerTargetUrl">Scanner Target URL</label>
					<div id="inputScannerTargetUrl" class="controls">
						<code>{{ scannerTargetUrl }}</code>
					</div>
				</div>
				
				<!-- ScannerMicroserviceId -->
				<div class="form-group">
					<label for="inputScannerMicroserviceId">Scanner MicroserviceId</label>
					<div id="inputScannerMicroserviceId" class="controls">
						<code>{{ scannerMicroserviceId }}</code>
					</div>
				</div>
				
				<!-- ScannerMicroserviceRunId -->
				<div class="form-group">
					<label for="inputScannerMicroserviceRunId">Scanner MicroserviceRunId</label>
					<div id="inputScannerMicroserviceRunId" class="controls">
						<code>{{ scannerMicroserviceRunId }}</code>
					</div>
				</div>
				
				<!-- includeRegexes -->
			    <div class="form-group">
				      <label for="inputScannerIncludeRegexes">Include sitemap pages by regular expression</label>
				      <div id="inputScannerIncludeRegexes" class="controls">
				        	<code>{{ scannerIncludeRegexes }}</code>
				      </div>
			    </div>
				
				<!-- includeRegexes -->
			    <div class="form-group">
				      <label for="inputScannerExcludeRegexes">Exclude sitemap pages by regular expression</label>
				      <div id="inputScannerExcludeRegexes" class="controls">
				        	<code>{{ scannerExcludeRegexes }}</code>
				      </div>
			    </div>
			</div>
			
			<div>
				<h3>Reporting Configuration</h3>
				
				<!-- Reporting Type configuration -->
				<div class="form-group">
					<label for="selectReportingTypes">Reporting Type Configuration</label>
					<div id="selectReportingTypes" class="controls">
						<code>{{ reportingTypes }}</code>
					</div>
				</div>
				
				<!-- False/Positive -->
		    	<div class="form-group">
				      <label for="textAreaReportingFalsePositive">Reporting False/Positives</label>
				      <div id="textAreaReportingFalsePositive" class="controls">
				        	<code>{{ reportingFalsePositive }}</code>
				      </div>
			    </div>
				
			</div>
			
			<h2>Approve Result</h2>
			<!-- reporting configuration -->
			<div class="form-group">
				<label for="selectResultApproved">Approve Result</label>
				<div id="selectResultApproved" class="controls">
					<!--select box -->
					<select required 
							class="form-control" 
							name="resultApproved"
							cam-variable-name="ZAP_RESULT_APPROVED"
							cam-variable-type="String">
						<option value="approved" checked>Approved (Finished)</option>
						<option value="disapproved">Not Approved (Restart Scan)</option>
						<option value="restart">Change Configuration (Restart)</option>
					</select>
				</div>
			</div>
			
		</div>
	</div>
</form>