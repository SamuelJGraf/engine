<!--
  ~ /*
  ~ * SecureCodeBox (SCB)
  ~ * Copyright 2015-2018 iteratec GmbH
  ~ *
  ~ * Licensed under the Apache License, Version 2.0 (the "License");
  ~ * you may not use this file except in compliance with the License.
  ~ * You may obtain a copy of the License at
  ~ *
  ~ * 	http://www.apache.org/licenses/LICENSE-2.0
  ~ *
  ~ * Unless required by applicable law or agreed to in writing, software
  ~ * distributed under the License is distributed on an "AS IS" BASIS,
  ~ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ * See the License for the specific language governing permissions and
  ~ * limitations under the License.
  ~ */
  -->

<h2>Please configure further Scans</h2>

<form role="form" name="configure_target">

    <script cam-script type="text/form-script">
        camForm.on('form-loaded', function () {
            camForm.variableManager.fetchVariable('DEFAULT_CONTEXT');
            camForm.variableManager.fetchVariable('DEFAULT_TARGET_NAME');
            camForm.variableManager.fetchVariable('DEFAULT_TARGET_LOCATION');
        });

        camForm.on('variables-fetched', function () {
            $scope.context = camForm.variableManager.variableValue('DEFAULT_CONTEXT');

            $scope.targetList = [{
                name: camForm.variableManager.variableValue('DEFAULT_TARGET_NAME'),
                location: camForm.variableManager.variableValue('DEFAULT_TARGET_LOCATION')
            }];

            $scope.addTarget = function () {
                $scope.targetList.push({'name': '', 'location': ''});
            };

            $scope.checkForEnter = function ($event) {
                if ($event.key === 'Enter') {
                    $scope.addTarget();
                    $event.stopPropagation();
                    $event.preventDefault();
                }
            };
        });

        camForm.on('submit', function () {
            camForm.variableManager.createVariable({
                name: 'PROCESS_TARGETS',
                type: 'Object',
                value: JSON.stringify($scope.targetList),
                valueInfo: {
                    serializationDataFormat: 'application/json',
                    objectTypeName: 'java.lang.String'
                }
            });
        });

    </script>

    <div class="row">

        <div class="col-xs-12">
            <h3>Further Scan Selection</h3>

            <fieldset>
                <div class="form-group">
                    <label for="inputLicense">I'm aware of and I do accept the
                        <a href="https://github.com/Arachni/arachni/blob/master/LICENSE.md" target="_blank"
                           style="text-decoration: underline;">Arachni license terms</a>
                    </label>
                    <div class="controls">
                        <input class="form-control" id="inputLicense" type="checkbox" ng-required="true" name="acceptLicense" ng-model="acceptLicense"
                        />
                    </div>
                </div>

                <br>
                <button class="btn btn-info pull-right scanner-btn" onclick="togglediv('arachniScope');" type="button">
                    <span class="glyphicon glyphicon-search "></span> Define the scans scope
                </button>
                <div id="arachniScope" name="scopeDefinition" style="display: none">
                    <label for="include_path_patterns">Included paths of the scanner (e.g. ".*login"), (in-/exclude paths are exclusive, you can only use one!)</label>
                    <br>
                    <textarea id="include_path_patterns" name="include_path_patterns" class="form-control" rows="5" ng-model="target.attributes.ARACHNI_INCLUDE_PATTERNS"></textarea>
                    <br>

                    <label for="exclude_path_patterns">Excluded paths of the scanner (e.g. "restricted/.*"), (in-/exclude paths are exclusive, you can only use
                        one!)</label>
                    <br>
                    <textarea id="exclude_path_patterns" name="exclude_path_patterns" class="form-control" rows="5" ng-model="target.attributes.ARACHNI_EXCLUDE_PATTERNS"></textarea>
                    <br>

                    <label for="dom_depth_limit">Limit of DOM depth</label>
                    <br>
                    <input id="dom_depth_limit" ng-model="target.attributes.ARACHNI_DOM_DEPTH_LIMIT" type="number" class="form-control" placeholder="1000">
                    <br>

                    <label for="directory_depth_limit">Limit of directory depths</label>
                    <br>
                    <input id="directory_depth_limit" ng-model="target.attributes.ARACHNI_DIR_DEPTH_LIMIT" type="number" class="form-control" placeholder="1000"
                    />
                    <br>

                    <label for="page_limit">Limit of scanned pages</label>
                    <br>
                    <input id="page_limit" ng-model="target.attributes.ARACHNI_PAGE_LIMIT" type="number" class="form-control" placeholder="1000"/>
                </div>
                <div class="clearfix"></div>
            </fieldset>
        </div>
    </div>
</form>
