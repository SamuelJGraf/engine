<form role="form" name="configure-reporting">
	<script cam-script type="text/form-script">
		camForm.on('form-loaded', function() {
			camForm.variableManager.fetchVariable('NIKTO_TARGET_NAME');
		  	camForm.variableManager.fetchVariable('PROCESS_CONTEXT');

		  	camForm.variableManager.fetchVariable('PROCESS_FINDINGS');

		  	camForm.variableManager.fetchVariable('NIKTO_TARGET');
		  	camForm.variableManager.fetchVariable('NIKTO_PORTS');
		  	camForm.variableManager.fetchVariable('NIKTO_PARAMETER');
		});

		camForm.on('variables-restored', function() {
			$scope.targetName = camForm.variableManager.variableValue('NIKTO_TARGET_NAME');
		  	$scope.context = camForm.variableManager.variableValue('PROCESS_CONTEXT');

		  	$scope.result = camForm
				.variableManager
				.variableValue('PROCESS_FINDINGS')
				.reduce(
			  		function (carry, element) {
			    		var key = element.attributes.ip_address + ':' + element.attributes.port;

						if(!carry.hasOwnProperty(key)){
				  			carry[key] = [];
						}
						carry[key].push(element);
						return carry;
			  		},
			  		{}
				);

		  	console.log($scope.result);

          	$scope.niktoScannerTarget = camForm.variableManager.variableValue('NIKTO_TARGET');
		  	$scope.niktoScannerPorts = camForm.variableManager.variableValue('NIKTO_PORTS');
		  	$scope.niktoScannerParameter = camForm.variableManager.variableValue('NIKTO_PARAMETER');
		});
	</script>

	<h2>Nikto-Scan results for "{{ targetName }}"</h2>

	<div class="row">
		<div class="col-xs-12">
			<div>
				<label>Target Host:</label>
				<p>{{ niktoScannerTarget }}</p>
			</div>
			<div>
				<label>Scanned Ports:</label>
				<p>{{ niktoScannerPorts }}</p>
			</div>
			<div>
				<label>Additional Arguments</label>
				<code>{{ niktoScannerParameter }}</code>
			</div>

			<div class="form-group hidden">
				<label>Result:</label>
				<code>{{ result }}</code>
			</div>

			<div class="well well-sm"
				 style="color: inherit;"
				 ng-repeat="(host, group) in result">
				<strong>Results for Host: {{ host }}</strong>
				<table class="table table-striped">
					<tr>
						<th>Path:</th>
						<th>Method:</th>
						<th>Description:</th>
						<th>Action:</th>
					</tr>
					<tr class="danger" ng-repeat="finding in group">
						<td style="max-width: 175px; overflow: scroll">{{ finding.location }}</td>
						<td>{{ finding.attributes.method }}</td>
						<td>{{ finding.name }}</td>
						<td>
							<span class="label label-success ng-binding">
								<i aria-hidden="true"
								   class="glyphicon glyphicon-ok"></i>
								Ignore
							</span>
						</td>
					</tr>
				</table>
			</div>

			<h2>Approve Result</h2>
			<!-- reporting configuration -->
			<div class="form-group">
				<div class="controls">
					<label for="selectResultApproved">Approve Result</label>
					<select required
							id="selectResultApproved"
							class="form-control"
							name="resultApproved"
							cam-variable-name="resultApproved"
							cam-variable-type="String">
						<option value="approved" selected>Approved (Finished)</option>
						<option value="dissapproved">Not Approved (Restart Scan)</option>
					</select>
				</div>
			</div>
		</div>
	</div>
</form>